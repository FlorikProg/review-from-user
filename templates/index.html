<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="file/main.css">
    <title>–û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å</title>
</head>
<body>

<div class="feedback-container">
    <h2 id="typing-effect"></h2>

    <div class="product-select">
        <label for="product">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–¥—É–∫—Çüëá</label>
        <select id="product">
            <option value="bot1">–ë–æ—Ç 1</option>
            <option value="bot2">–ë–æ—Ç 2</option>
        </select>
    </div>

    <div id="message-form" class="message-input">
        <img src="https://upload.wikimedia.org/wikipedia/commons/8/83/Telegram_2019_Logo.svg" alt="Telegram" width="20px">
        <textarea id="message" rows="1" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ..." required></textarea>
    </div>

    <p id="message-sent"></p>

    <div class="stars" id="star-rating">
        <span class="star" data-value="1">‚òÖ</span>
        <span class="star" data-value="2">‚òÖ</span>
        <span class="star" data-value="3">‚òÖ</span>
        <span class="star" data-value="4">‚òÖ</span>
        <span class="star" data-value="5">‚òÖ</span>
    </div>

    <form id="message-form_btn">
        <button type="submit" class="submit-btn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </form>

</div>

<script>
    const stars = document.querySelectorAll('.star');
    let selectedRating = 0;

    stars.forEach(star => {
        star.addEventListener('click', () => {
            selectedRating = star.getAttribute('data-value');
            updateStars(selectedRating);
        });
    });

    function updateStars(rating) {
        stars.forEach(star => {
            if (star.getAttribute('data-value') <= rating) {
                star.classList.add('selected');
            } else {
                star.classList.remove('selected');
            }
        });
    }

    const text = "–û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å üìû"; 
    let index = 0;

    function type() {
        if (index < text.length) {
            document.getElementById("typing-effect").innerHTML += text.charAt(index);
            index++;
            setTimeout(type, 100);
        }
    }

    const text2 = "–°–æ–æ–±—â–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ –ª–∏—á–Ω–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É...";
    let index2 = 0;

    function type2() {
        if (index2 < text2.length) {
            document.getElementById("message-sent").innerHTML += text2.charAt(index2);
            index2++;
            setTimeout(type2, 100);
        }
    }
    
    type();
    type2();
    document.getElementById('message-form_btn').onsubmit = async function(e) {
    e.preventDefault();
    
    const messageText = document.getElementById('message').value;
    const product = document.getElementById('product').value;
    const rating = selectedRating; // This should hold the correct rating value

    // Debugging: Log the collected data to the console
    console.log("Message Text:", messageText);
    console.log("Selected Product:", product);
    console.log("Selected Rating:", rating);

    // Sending data to API
    const response = await fetch('/submit', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ text: messageText, rating: rating, product: product }) // Ensure correct field names
    });
    
    if (response.ok) {
        alert('–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ');
        document.getElementById('message').value = ''; // Clear input field
        updateStars(0); // Reset star rating after submission
    } else {
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è');
    }
};</script>

</body>
</html>